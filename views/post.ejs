<%- include('partials/header') -%>
<link rel="stylesheet" href="/css/output.css" >

<section class="split">
  <section>
    <h2 class="text-center">Title: <%= post.title %></h2>
    <!-- <%= JSON.stringify(post._id) %>  used to test why post.id rather than post._id works -->
    <img class="postMedia" src="<%= post.image%>" />
    <div class="">
      <p class="text-center">Caption: <%= post.caption %></p>
    </div>

    <div class="likeSection">
      <form
        class=""
        action="/post/likePost/<%= post.id %>?_method=PUT" 
        method="POST" 
      >
      <button class="btn" type="submit">Like</button>
      </form>
      <span class="">Likes: <%= post.likes %></span>
    </div>
    

    <%if(post.user == user.id){ %>
    <form
      action="/post/deletePost/<%= post.id %>?_method=DELETE"
      method="POST"
      class="buttonCenter"
    >
      <button class="btn" type="submit">Delete</button>
    </form>
    <%}%>
  </section>
    
  <section>
  <!-- Made with Layoyo &B Blu on 5/7/2025 -->
    <form
      action="/comment/createComment/<%= post.id %>"
      method="POST"
      class="commentForm"
    >
      <input type="text" class="" name="comment" placeholder="Leave a comment."></input>
      <button class="btn btn-primary fa fa-comment" type="submit"> Comment</button>
    </form>
    <ul class="">
    <% for(var i=0; i<comments.length; i++) {%> 
        <li class="commentSheet">
        <%= comments[i].text %>
        <form action="/comment/likeComment/<%= comments[i].id %>?_method=PUT" method="POST"> <button class="btn" type="submit"> <%= comments[i].likes %> Likes </button></form>

    <%if(post.user == user.id || comments[i].postedBy == user.id){ %> 
      <!-- person who made post == person logged in OR person who commented == person logged in -> you can delete the comment!!! yay ty Layoyo <3 -->
      <form action="/comment/deleteComment/<%= comments[i].id %>?_method=PUT" method="POST"> <button class="btn" type="submit"> Delete</button></form> 
      <% } %>
      </li>
      <% } %>
    </ul>
  </section>

  <section>
    <form id="translationForm" action="/post/translatePost/<%= post.id %>" method="POST" class="buttonCenter"><button class="btn" type="submit"> Translate </button></form>
    <div id="translatedParagraph">
      <p></p>
    </div>
    </section>


 <script>
  const translationForm = document.querySelector("#translationForm")
  translationForm.addEventListener('submit', (event) => {
    event.preventDefault() 
    fetch("/post/translatePost/<%= post.id %>")
      .then(res => res.json())
      .then(data => {
          console.log(data)
          document.querySelector("#translatedParagraph p").innerText = data.translated
      })
    .catch(err => {
        console.log(`error ${err}`)
    })
  })
</script> 
</section>

<div class="buttonCenter gap">
  <a class="btn " href="/profile">Return to Profile</a>
  <a class="btn " href="/feed">Return to Harvest</a>
</div>

<%- include('partials/footer') -%>